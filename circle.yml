machine:
  pre:
    - sudo apt-get update
    - sudo apt-get --reinstall install -qq language-pack-ja
    - sudo update-locale LANG=ja_JP.UTF-8

  timezone: Asia/Tokyo

  environment:
    LANG: ja_JP.UTF-8
    LC_ALL: ja_JP.UTF-8
    PERL_VERSION: 5.22.0
    PERL_DIR: $HOME/perl
    PATH: $PERL_DIR/bin:$PATH

dependencies:
  cache_directories:
    - ~/cache
    - ~/perl

  pre:
    # Install MySQL
    - mkdir -p ~/cache
    - |
      if [[ ! -f ~/cache/mysql-5.6.14.deb ]]; then
        wget -O ~/cache/mysql-5.6.14.deb http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.14-debian6.0-x86_64.deb/from/http://cdn.mysql.com/
      else
        echo "Skip download MySQL"
      fi
    - sudo apt-get remove mysql-common
    - sudo apt-get autoremove
    - sudo dpkg -i ~/cache/mysql-5.6.14.deb
    - sudo /opt/mysql/server-5.6/scripts/mysql_install_db --user=mysql --basedir=/opt/mysql/server-5.6
    - sudo /opt/mysql/server-5.6/support-files/mysql.server start

    # Install Perl
    - test -d $PERL_DIR || curl https://raw.githubusercontent.com/tokuhirom/Perl-Build/master/perl-build | perl - $PERL_VERSION $PERL_DIR
    - curl -L https://cpanmin.us/ | perl - --notest Carton

  override:
    - npm install
    - echo "carton install"

